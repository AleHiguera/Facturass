@page "/detalle-factura/{FacturaId:int}"
@rendermode InteractiveServer
@using blazor.Components.Data
@using blazor.Components.Servicios
@inject blazor.Components.Servicios.ServicioControlador ServicioControlador
@inject NavigationManager Navigation

<PageTitle>Detalle Factura #@FacturaId</PageTitle>

<div class="facturapro-bg min-h-screen p-4 sm:p-8 flex justify-center">
    <div class="fp-page-container w-full max-w-4xl p-6 md:p-8">

        @if (FacturaDetalle == null)
        {
            <h3 class="text-3xl font-bold fp-primary-color mb-4">Factura no encontrada 💔</h3>
            <div class="p-4 rounded-xl shadow-md" style="background-color: var(--fp-surface-alt); border: 2px solid var(--fp-primary);">
                <p class="font-bold" style="color: var(--fp-on-surface);">No se pudo cargar la factura con ID: **@FacturaId**.</p>
            </div>
        }
        else
        {
            <h1 class="text-4xl font-extrabold mb-4" style="color: var(--fp-primary);">
                Detalle de Factura #@FacturaDetalle.Id
                <i class="oi oi-document" style="font-size: 1.5rem; color: var(--fp-secondary);"></i>
            </h1>
             <hr>

            <hr style="border-top: 2px solid var(--fp-primary-border);" class="mb-6" />

            <div class="bg-white p-6 rounded-xl facturapro-card-shadow border" style="border-color: var(--fp-primary-border);">

                <div class="p-3 rounded-lg mb-4" style="background-color: var(--fp-primary-soft); color: var(--fp-on-primary-soft);">
                    <h5 class="text-xl font-bold mb-0">Cliente: **@FacturaDetalle.NombreCliente**</h5>
                </div>

                <p class="text-lg mb-4" style="color: var(--fp-on-surface);">
                    <strong>Fecha de Emisión:</strong> <span class="font-semibold" style="color: var(--fp-secondary);">@FacturaDetalle.FechaFactura.ToShortDateString()</span>
                </p>

                <h5 class="text-xl font-semibold mb-3" style="color: var(--fp-secondary);">Artículos Incluidos:</h5>

                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse" style="border: 1px solid var(--fp-primary-border);">

                        <thead style="background-color: var(--fp-primary-soft); color: var(--fp-on-primary-soft);">
                            <tr class="text-sm uppercase font-semibold tracking-wider">
                                <th class="p-3 border-b-2" style="border-bottom-color: var(--fp-secondary);">Descripción</th>
                                <th class="p-3 border-b-2 text-end" style="border-bottom-color: var(--fp-secondary);">Cantidad</th>
                                <th class="p-3 border-b-2 text-end" style="border-bottom-color: var(--fp-secondary);">Precio Unitario</th>
                                <th class="p-3 border-b-2 text-end" style="border-bottom-color: var(--fp-secondary);">Subtotal</th>
                            </tr>
                        </thead>

                        <tbody>
                            @foreach (var item in FacturaDetalle.Articulos)
                            {
                                <tr class="hover:bg-gray-50 transition duration-150" style="color: var(--fp-on-surface-variant);">
                                    <td class="p-3 border-b" style="border-color: var(--fp-primary-border);">@item.Descripcion</td>
                                    <td class="p-3 border-b text-end" style="border-color: var(--fp-primary-border);">@item.Cantidad</td>
                                    <td class="p-3 border-b text-end" style="border-color: var(--fp-primary-border);">@item.Precio.ToString("C2")</td>
                                    <td class="p-3 border-b text-end" style="border-color: var(--fp-primary-border);">@item.Subtotal.ToString("C2")</td>
                                </tr>
                            }
                        </tbody>

                        <tfoot>
                            <tr style="background-color: var(--fp-primary); color: white;">
                                <th class="p-3 text-lg" colspan="3">TOTAL DE FACTURA</th>
                                <th class="p-3 text-end text-lg font-extrabold">@FacturaDetalle.Total.ToString("C2")</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        }
    </div>
</div>

<div class="fab-container">
    
    <button class="fp-efab" @onclick="VolverALista">
        <i class="oi oi-list"></i> Volver a Facturas
    </button>
</div>


@code {
    [Parameter]
    public int FacturaId { get; set; }

    private Factura? FacturaDetalle { get; set; }

    protected override async Task OnInitializedAsync()
    {
        FacturaDetalle = await ServicioControlador.ObtenerFacturaPorIdAsync(FacturaId);
    }
    private void VolverALista()
    {
        Navigation.NavigateTo("/Vista");
    }
    private void NavigateToHome()
    {
        Navigation.NavigateTo("/");
    }
}